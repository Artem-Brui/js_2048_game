const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.directions={right:"right",left:"left",up:"up",down:"down"},this.status={idle:"idle",playing:"playing",win:"win",lose:"lose"},this.initialState=t,this.state=t,this.currentStatus=this.status.idle,this.lastRandomZeroIndex=0,this.score=0,this.copyBoard=t=>t.map(t=>[...t]),this.goThroughCells=(t,e)=>t.map(t=>t.map(t=>e(t))),this.getRandomZeroSerialNumber=t=>{let e;if(t>1){let s=()=>Math.floor(Math.random()*t+1);do e=s();while(e===this.lastRandomZeroIndex)}return this.lastRandomZeroIndex=e,1===t?1:e},this.getNumberToAdd=t=>100*Math.random()+1<t?4:2,this.getZerosAmount=t=>t.flat().filter(t=>0===t).length,this.addNumbersToBoard=(t=1)=>{let e=this.copyBoard(this.state),s=t=>{if(this.getZerosAmount(t)>0){let s=this.getNumberToAdd(10),r=this.getZerosAmount(t),a=this.getRandomZeroSerialNumber(r),i=0;return e=this.goThroughCells(t,t=>(0===t&&i++,a===i&&0===t?s:t))}};for(let r=0;r<t;r++)e=s(this.copyBoard(e));return e},this.moveValues=t=>{let e=t=>t[0].map((e,s)=>t.map(t=>t[s])),s=t===this.directions.up||t===this.directions.down,r=t===this.directions.right||t===this.directions.down,a=(s?e(this.state):this.state).map(t=>{let e=r?t.filter(t=>0!==t).reverse():t.filter(t=>0!==t);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&0!==e[t]&&(e[t+1]=0,e[t]*=2,this.score+=e[t]);let s=r?e.filter(t=>0!==t).reverse():e.filter(t=>0!==t),a=Array(4-s.length).fill(0);return r?[...a,...s]:[...s,...a]});return s?e(a):a},this.canVerticalMerge=()=>{let t=!1;return this.state.forEach((e,s)=>{e.forEach((e,r)=>{let a;s<this.state.length-1&&(a=e===this.state[s+1][r]),a&&(t=!0)})}),t},this.canHorizontalMerge=()=>{let t=!1;return this.state.forEach(e=>{e.forEach((s,r)=>{let a;r<e.length-1&&(a=s===e[r+1]),a&&(t=!0)})}),t},this.isEquelToState=t=>this.state.every((e,s)=>e.every((e,r)=>e===t[s][r]))}moveLeft(){let t=this.moveValues(this.directions.left);"playing"!==this.currentStatus||this.isEquelToState(t)||(this.state=t,this.state=this.addNumbersToBoard(1))}moveRight(){let t=this.moveValues(this.directions.right);"playing"!==this.currentStatus||this.isEquelToState(t)||(this.state=t,this.state=this.addNumbersToBoard(1))}moveUp(){let t=this.moveValues(this.directions.up);"playing"!==this.currentStatus||this.isEquelToState(t)||(this.state=t,this.state=this.addNumbersToBoard(1))}moveDown(){let t=this.moveValues(this.directions.down);"playing"!==this.currentStatus||this.isEquelToState(t)||(this.state=t,this.state=this.addNumbersToBoard(1))}getScore(){return this.score}getState(){return this.state}getStatus(){let t=!1,e=this.currentStatus,s=this.getZerosAmount(this.state),r=this.canVerticalMerge()||this.canHorizontalMerge();return this.state.forEach(e=>{e.forEach(e=>{2048===e&&(t=!0)})}),t?e=this.status.win:0!==s||r||(e=this.status.lose),e}start(){this.currentStatus="playing",this.state=this.addNumbersToBoard(2)}restart(){this.currentStatus="idle",this.state=this.initialState,this.score=0}},e={start:document.querySelector(".start"),restart:document.querySelector(".restart"),messageWin:document.querySelector(".message-win"),messageLose:document.querySelector(".message-lose"),messageStart:document.querySelector(".message-start"),cells:[...document.querySelectorAll(".field-cell")],score:document.querySelector(".game-score")},s=()=>{t.state.forEach((t,s)=>{let r=4*s;t.forEach((t,s)=>{let a=e.cells[s+r],i=0===t?"field-cell":`field-cell field-cell--${t}`;a.textContent=0!==t?t:"",a.className=i})}),e.score.textContent=t.score,t.currentStatus===t.status.playing&&e.messageStart.classList.add("hidden"),t.currentStatus===t.status.win&&e.messageWin.classList.remove("hidden"),t.currentStatus===t.status.lose&&e.messageLose.classList.remove("hidden")},r=()=>{switch(t.getStatus()){case t.status.win:t.currentStatus=t.status.win;break;case t.status.lose:t.currentStatus=t.status.lose}};e.start.addEventListener("click",()=>{t.start(),e.start.classList.add("hidden"),e.restart.classList.remove("hidden"),s()}),e.restart.addEventListener("click",()=>{t.restart(),e.restart.classList.add("hidden"),e.start.classList.remove("hidden"),e.start.classList.remove("hidden"),e.messageStart.classList.remove("hidden"),document.querySelector(".message-lose").className="message message-lose hidden",e.messageWin.className="message message-win hidden",s()}),document.addEventListener("keydown",e=>{if("playing"===t.getStatus()){switch(e.key){case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight()}r(),s()}});
//# sourceMappingURL=index.ef4768ea.js.map
