!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,r){if(e){if("string"==typeof e)return t(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r=new(function(){var t;function r(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],s=this;!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,r),this.directions={right:"right",left:"left",up:"up",down:"down"},this.status={idle:"idle",playing:"playing",win:"win",lose:"lose"},this.initialState=n,this.state=n,this.currentStatus=this.status.idle,this.lastRandomZeroIndex=0,this.score=0,this.copyBoard=function(t){return t.map(function(t){return e(t)})},this.goThroughCells=function(t,e){return t.map(function(t){return t.map(function(t){return e(t)})})},this.getRandomZeroSerialNumber=function(e){var r;if(e>1)do r=Math.floor(Math.random()*e+1);while(r===t.lastRandomZeroIndex)return t.lastRandomZeroIndex=r,1===e?1:r},this.getNumberToAdd=function(t){return 100*Math.random()+1<t?4:2},this.getZerosAmount=function(t){return t.flat().filter(function(t){return 0===t}).length},this.addNumbersToBoard=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=s.copyBoard(s.state),r=0;r<t;r++)e=function(t){if(s.getZerosAmount(t)>0){var r=s.getNumberToAdd(10),n=s.getZerosAmount(t),a=s.getRandomZeroSerialNumber(n),i=0;return e=s.goThroughCells(t,function(t){return 0===t&&i++,a===i&&0===t?r:t})}}(s.copyBoard(e));return e},this.moveValues=function(r){var n=function(t){return t[0].map(function(e,r){return t.map(function(t){return t[r]})})},s=r===t.directions.up||r===t.directions.down,a=r===t.directions.right||r===t.directions.down,i=(s?n(t.state):t.state).map(function(r){for(var n=a?r.filter(function(t){return 0!==t}).reverse():r.filter(function(t){return 0!==t}),s=0;s<n.length;s++)n[s]===n[s+1]&&0!==n[s]&&(n[s+1]=0,n[s]*=2,t.score+=n[s]);var i=a?n.filter(function(t){return 0!==t}).reverse():n.filter(function(t){return 0!==t}),o=Array(4-i.length).fill(0);return a?e(o).concat(e(i)):e(i).concat(e(o))});return s?n(i):i},this.canVerticalMerge=function(){var e=!1;return t.state.forEach(function(r,n){r.forEach(function(r,s){var a;n<t.state.length-1&&(a=r===t.state[n+1][s]),a&&(e=!0)})}),e},this.canHorizontalMerge=function(){var e=!1;return t.state.forEach(function(t){t.forEach(function(r,n){var s;n<t.length-1&&(s=r===t[n+1]),s&&(e=!0)})}),e},this.isEquelToState=function(e){return t.state.every(function(t,r){return t.every(function(t,n){return t===e[r][n]})})}}return t=[{key:"moveLeft",value:function(){var t=this.moveValues(this.directions.left);"playing"!==this.currentStatus||this.isEquelToState(t)||(this.state=t,this.state=this.addNumbersToBoard(1))}},{key:"moveRight",value:function(){var t=this.moveValues(this.directions.right);"playing"!==this.currentStatus||this.isEquelToState(t)||(this.state=t,this.state=this.addNumbersToBoard(1))}},{key:"moveUp",value:function(){var t=this.moveValues(this.directions.up);"playing"!==this.currentStatus||this.isEquelToState(t)||(this.state=t,this.state=this.addNumbersToBoard(1))}},{key:"moveDown",value:function(){var t=this.moveValues(this.directions.down);"playing"!==this.currentStatus||this.isEquelToState(t)||(this.state=t,this.state=this.addNumbersToBoard(1))}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state}},{key:"getStatus",value:function(){var t=!1,e=this.currentStatus,r=this.getZerosAmount(this.state),n=this.canVerticalMerge()||this.canHorizontalMerge();return this.state.forEach(function(e){e.forEach(function(e){2048===e&&(t=!0)})}),t?e=this.status.win:0!==r||n||(e=this.status.lose),e}},{key:"start",value:function(){this.currentStatus="playing",this.state=this.addNumbersToBoard(2)}},{key:"restart",value:function(){this.currentStatus="idle",this.state=this.initialState,this.score=0}}],function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(r.prototype,t),r}()),n={start:document.querySelector(".start"),restart:document.querySelector(".restart"),messageWin:document.querySelector(".message-win"),messageLose:document.querySelector(".message-lose"),messageStart:document.querySelector(".message-start"),cells:e(document.querySelectorAll(".field-cell")),score:document.querySelector(".game-score")},s=function(){r.state.forEach(function(t,e){var r=4*e;t.forEach(function(t,e){var s=n.cells[e+r];s.textContent=0!==t?t:"",s.className=0===t?"field-cell":"field-cell field-cell--".concat(t)})}),n.score.textContent=r.score,r.currentStatus===r.status.playing&&n.messageStart.classList.add("hidden"),r.currentStatus===r.status.win&&n.messageWin.classList.remove("hidden"),r.currentStatus===r.status.lose&&n.messageLose.classList.remove("hidden")},a=function(){switch(r.getStatus()){case r.status.win:r.currentStatus=r.status.win;break;case r.status.lose:r.currentStatus=r.status.lose}};n.start.addEventListener("click",function(){r.start(),n.start.classList.add("hidden"),n.restart.classList.remove("hidden"),s()}),n.restart.addEventListener("click",function(){r.restart(),n.restart.classList.add("hidden"),n.start.classList.remove("hidden"),n.start.classList.remove("hidden"),n.messageStart.classList.remove("hidden"),document.querySelector(".message-lose").className="message message-lose hidden",n.messageWin.className="message message-win hidden",s()}),document.addEventListener("keydown",function(t){if("playing"===r.getStatus()){switch(t.key){case"ArrowUp":r.moveUp();break;case"ArrowDown":r.moveDown();break;case"ArrowLeft":r.moveLeft();break;case"ArrowRight":r.moveRight()}a(),s()}})}();
//# sourceMappingURL=index.35195ad2.js.map
